{% extends 'process/process_layout.html' %}

{% block process_content %}
<div class="row gap-0">
    <div class="col-xl-8">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-calendar-event"></i> Create Scheduled Task
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label">Cron Schedule Expression</label>
                        <div class="input-group">
                            <input type="text" class="form-control" name="schedule" 
                                   placeholder="0 8 * * * (Daily at 8 AM)" required>
                        </div>
                        <small class="text-muted">Use standard cron expression format (minute hour day month weekday)</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Action to Schedule</label>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-check align-items-normal">
                                    <input id="action-start" class="form-check-input" type="radio" name="action" value="start" required>
                                    <label for="action-start" class="form-check-label">
                                        <i class="bi bi-play-circle text-success"></i> Start Process
                                    </label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check align-items-normal">
                                    <input id="action-stop" class="form-check-input" type="radio" name="action" value="stop">
                                    <label for="action-stop" class="form-check-label">
                                        <i class="bi bi-stop-circle text-danger"></i> Stop Process
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-plus-circle"></i> Schedule Task
                    </button>
                </form>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <i class="bi bi-list-check"></i> Active Scheduled Tasks
            </div>
            {% if cron_jobs %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Task Name</th>
                            <th>Schedule</th>
                            <th>Command</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for job in cron_jobs %}
                        <tr>
                            <td>{{ job.name }}</td>
                            <td style="white-space: nowrap;"><code>{{ job.schedule }}</code></td>
                            <td><span class="badge bg-info">{{ job.command }}</span></td>
                            <td>
                                <form action="{{ url_for('process.delete_cron_job', name=process.name) }}" method="POST" class="d-inline">
                                    <input type="hidden" name="line" value="{{ job.line }}">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="card-body">
                <div class="text-center py-4">
                    <i class="bi bi-calendar-x display-4 text-muted"></i>
                    <p class="text-muted mt-3">No scheduled tasks configured for this process.</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="col-xl-4">
        <div class="card">
            <div class="card-header bg-info">
                <i class="bi bi-info-circle"></i> Cron Expression Guide
            </div>
            <div class="card-body">
                <h6>Format: minute hour day month weekday</h6>
                <table class="table table-sm">
                    <tbody>
                        <tr>
                            <td><code>* * * * *</code></td>
                            <td>Every minute</td>
                        </tr>
                        <tr>
                            <td><code>0 * * * *</code></td>
                            <td>Every hour</td>
                        </tr>
                        <tr>
                            <td><code>0 8 * * *</code></td>
                            <td>Daily at 8 AM</td>
                        </tr>
                        <tr>
                            <td><code>0 0 * * 0</code></td>
                            <td>Weekly (Sunday)</td>
                        </tr>
                        <tr>
                            <td><code>0 0 1 * *</code></td>
                            <td>Monthly (1st day)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header bg-warning">
                <i class="bi bi-exclamation-triangle"></i> Important Notes
            </div>
            <div class="card-body">
                <ul class="small mb-0">
                    <li>All times are in server timezone</li>
                    <li>Tasks run with process permissions</li>
                    <li>Failed tasks will be logged</li>
                    <li>Maximum 10 tasks per process</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
.input-group {
    display: flex;
    gap: 10px;
}
.btn-info {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
}
.btn-primary {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 8px 15px;
    cursor: pointer;
}
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
}
.modal-content {
    background-color: #171717;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #232323;
    width: 80%;
    max-width: 400px;
    text-align: center;
}
.close {
    float: right;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
}
.cheatsheet-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}
.cheatsheet-table th, .cheatsheet-table td {
    border: 1px solid #ddd;
    padding: 8px;
}
.cheatsheet-table th {
    background-color: #000;
}
.note {
    font-size: 12px;
    color: #555;
}
</style>
{% endblock process_content %}
