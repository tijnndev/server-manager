version: '3.8'

services:
  roundcube:
    image: roundcube/roundcubemail:latest
    container_name: roundcube
    ports:
      - "8080:80"  # Expose Roundcube's web UI on port 8080
    environment:
      ROUNDCUBEMAIL_REQUEST_PATH: /roundcube/  # Path to access Roundcube
      ROUNDCUBEMAIL_DEFAULT_HOST: mailserver   # IMAP server hostname
      ROUNDCUBEMAIL_SMTP_SERVER: mail.tijnn.dev  # SMTP server hostname
      ROUNDCUBEMAIL_SMTP_PORT: 587  # SMTP port for sending emails
      ROUNDCUBEMAIL_SMTP_USER: smtp@tijnn.dev  # Optional: add SMTP user if needed
      ROUNDCUBEMAIL_SMTP_PASSWORD: yourpassword  # Optional: add SMTP password if needed
    depends_on:
      - mailserver
    networks:
      - mailnetwork

  mailserver:
    image: ghcr.io/docker-mailserver/docker-mailserver:latest
    container_name: mailserver
    hostname: mail
    domainname: tijnn.dev
    volumes:
      - ./maildata:/var/mail  # Store mail data
      - ./mailstate:/var/mail-state  # Store mail server state
      - ./maillogs:/var/log/mail  # Store mail logs
      - ./config/:/tmp/docker-mailserver/  # Configuration files for the mailserver
    ports:
      - "25:25"  # SMTP
      - "587:587"  # SMTP (submission)
      - "993:993"  # IMAPS (secure IMAP)
    environment:
      - ENABLE_SPAMASSASSIN=1  # Enable SpamAssassin
      - ENABLE_CLAMAV=1  # Enable ClamAV antivirus
      - MAIL_USER=smtp@tijnn.dev  # Example mail user to configure
      - MAIL_PASS=yourpassword  # Example password for the mail user
    cap_add:
      - NET_ADMIN  # Required for certain networking operations (e.g., handling email traffic)
    networks:
      - mailnetwork

networks:
  mailnetwork:
    driver: bridge
